---
title: "XML解析"
sequence: "211"
---

To date, you can take one of three distinct approaches to parsing XML documents:

- DOM parsing
- Push parsing
- Pull parsing

## DOM Approach

The Document Object Model (DOM) Level 3 Core specification specifies platform- and language-neutral interfaces
for accessing and manipulating content and specifies the structure of a generalized document.

The DOM represents a document as a tree of `Node` objects.
Some of these `Node` objects have child node objects; others are leaf objects with no children.

To represent the structure of an XML document,
the generic `Node` type is specialized to other `Node` types,
and each specialized node type specifies a set of allowable child `Node` types.

| Specialized Node Type | Description                           | Allowable Child Node Types                                                   |
|-----------------------|---------------------------------------|------------------------------------------------------------------------------|
| Document              | Represents an XML document            | DocumentType, ProcessingInstruction, Comment, Element(maximum of 1)          |
| DocumentFragment      | Represents part of an XML document    | Element, ProcessingInstruction, Comment, Text, CDATASection, EntityReference |
| DocumentType          | Represents a DTD for a document       | No children                                                                  |
| EntityReference       | Represents an entity reference        | Element, ProcessingInstruction, Comment, Text, CDATASection, EntityReference |
| Element               | Represents an element                 | Element, ProcessingInstruction, Comment, Text, CDATASection, EntityReference |
| Attr                  | Represents an attribute               | Text, EntityReference                                                        |
| ProcessingInstruction | Represents a processing instruction   | No children                                                                  |
| Comment               | Represents a comment                  | No children                                                                  |
| Text                  | Represents text, including whitespace | No children                                                                  |
| CDATASection          | Represents a CDATA section            | No children                                                                  |
| Entity                | Represents an entity                  | Element, ProcessingInstruction, Comment, Text, CDATASection, EntityReference |
| Notation              | Represents a notation                 | No children                                                                  |

The `Document` specialized node type is somewhat unique in that
at most only one instance of this type may exist within an XML document.
It is also worth noting that the `Document` node type is a specialized `Element` node type
and is used to represent the root element of an XML document.
`Text` node types, in addition to representing text, are also used to represent **whitespace** in an XML document.

## Push Approach

Under the push parsing approach, a push parser generates synchronous events as a document is parsed,
and these events can be processed by an application using a callback handler model.

An API for the push approach is available as SAX 2.0, which is also included in JAXP 1.3.
SAX is a read-only API.
The SAX API is recommended if no modification or random-access navigation of an XML document is required.

The SAX 2.0 API defines a `ContentHandler` interface,
which may be implemented by an application to define a callback handler
for processing synchronous parsing events generated by a SAX parser.

SAX 2.0 ContentHandler Event Methods

| Method                | Notification                      |
|-----------------------|-----------------------------------|
| startDocument         | Start of a document               |
| startElement          | Start of an element               |
| characters            | Character data                    |
| endElement            | End of an element                 |
| endDocument           | End of a document                 |
| startPrefixMapping    | Start of namespace prefix mapping |
| endPrefixMapping      | End of namespace prefix mapping   |
| skippedEntity         | Skipped entity                    |
| ignorableWhitespace   | Ignorable whitespace              |
| processingInstruction | Processing instruction            |

In addition to the `ContentHandler` interface, SAX 2.0 defines an `ErrorHandler` interface,
which may be implemented by an application to receive notifications about errors.

SAX 2.0 ErrorHandler Notification Methods

| Method       | Notification                                |
|--------------|---------------------------------------------|
| fatalError   | Violation of XML 1.0 well-formed constraint |
| error        | Violation of validity constraint            |
| warning      | Non-XML-related warning                     |

## Pull Approach

Under the **pull approach**, events are pulled from an XML document under the control of the application using the parser.
StAX is similar to the SAX API in that both offer event-based APIs.
However, StAX differs from the SAX API in the following respects:

- Unlike in the SAX API, in the StAX API, it is the application rather than the parser
  that controls the delivery of the parsing events.
  StAX offers two event-based APIs: **a cursor-based API** and **an iterator-based API**,
  both of which are under the application's control.
- The **cursor API** allows a walk-through of the document in document order and
  provides the lowest level of access to all the structural and content information within the document.
- The **iterator API** is similar to the cursor API but instead of providing low-level access,
  it provides access to the structural and content information in the form of event objects.
- Unlike the SAX API, the StAX API can be used both for reading and for writing XML documents.

### Cursor API

Key points about the StAX cursor API are as follows:

- The `XMLStreamReader` interface is the main interface for parsing an XML document.
  You can use this interface to scan an XML document's structure and contents using the `next()` and `hasNext()` methods.
- The `next()` method returns an integer token for the next parse event.
- Depending on the next event type, you can call specific allowed methods on the `XMLStreamReader` interface.

### Iterator API

Key points about the StAX iterator API are as follows:

- The `XMLEventReader` interface is the main interface for parsing an XML document.
  You can use this interface to iterate over an XML document's structure and contents
  using the `nextEvent()` and `hasNext()` methods.
- The `nextEvent()` method returns an `XMLEvent` object.
- The `XMLEvent` interface provides utility methods for determining the next event type and for processing it appropriately.

The StAX API is recommended for data-binding applications,
specifically for the marshaling and unmarshaling of an XML document during the bidirectional XML-to-Java mapping process.
A StAX API implementation is included in J2SE 6.0.

## Parsing with SAX 2.0

SAX 2.0 is an event-based API to parse an XML document.
SAX 2.0 is not a W3C Recommendation.
However, it is a widely used API that has become a de facto standard.

To date, SAX has two major versions: **SAX 1.0** and **SAX 2.0**.
There are no fundamental differences between the two versions.
The most notable difference is that the SAX 1.0 `Parser` interface is
replaced with the SAX 2.0 `XMLReader` interface,
which improves upon the SAX 1.0 interface by providing full support for namespaces.

In this chapter, we will focus only on the SAX 2.0 API.

SAX 2.0 is a push-model API; events are generated as an XML document is parsed.
Events are generated by the parser and
delivered through the callback methods defined by the application.

Key points pertaining to the use of the SAX 2.0 API are as follows:

You need to import at least two packages:
the `org.xml.sax` package for the SAX interfaces and
the `javax.xml.parsers` package for the `SAXParser` and SAXParserFactory `classes`.
In addition, you may need to import the `org.xml.sax.helpers` package,
which has useful helper classes for using the SAX API.

`ContentHandler` is the main interface that an application needs to implement
because it provides event notification about the parsing events.
The `DefaultHandler` class provides a default implementation of the `ContentHandler` interface.
To handle SAX parser events, an application can either define a class
that implements the `ContentHandler` interface or
define a class that extends the `DefaultHandler` class.

You use the `SAXParser` class to parse an XML document.

You obtain a `SAXParser` object from a `SAXParserFactory` object.
To obtain a SAX parser, you need to first create an instance of the `SAXParserFactory`
using the static method `newInstance()`,
as shown in the following example:

```text
SAXParserFactory factory = SAXParserFactory.newInstance();
```


XML解析方式：

- DOM解析
- SAX解析

XML解析工具：

- DOM解析
  - JAXP（Oracle官方）
  - JDOM工具（非官方）
  - Dom4J工具（非官方）
- SAX解析
  - SAX解析工具（Oracle官方）

BOM浏览器对象模型
DOM文档对象模型


## DOM

DOM解析原理：XML解析器一次性把整个`.xml`文档加载进内存，然后在内存中构建一棵Document的对象树；通过Document对象，得到树上的节点对象，通过节点对象访问（操作）XML文档的内容。

树只有一个根标签。树上的分支，叫节点（Node）。

- 节点信息（Node）
  - 节点名称
  - 节点类型
    - 标签节点：标签名称（Element）
    - 属性节点：属性名称、属性值（Attribute）
    - 文本节点：文本内容（Text）
    - 注释节点（Comment）

Document对象，代表一个完整的XML文档
