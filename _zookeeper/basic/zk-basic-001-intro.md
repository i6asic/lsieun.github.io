---
title: "ZooKeeper 介绍"
sequence: "101"
---

## ZooKeeper 是什么？

ZooKeeper 是一个分布式协调服务的开源框架，主要用来解决分布式集群中应用系统的一致性问题。

- ZooKeeper 本质上是一个分布式的小文件存储系统，提供基于类似于文件系统的目录树方式的数据存储，并且可以对树中的节点进行有效管理。
- ZooKeeper 提供给客户端监控存储在ZooKeeper 内部数据的功能，从而可以达到基于数据的集群管理。
  例如：统一命名服务（Dubbo）、分布式配置管理（Solr的配置集中管理）、分布式消息队列（Sub/Pub）、分布式锁、分布式协调等功能。

## ZooKeeper 的架构组成

### Leader

- ZooKeeper 集群工作的核心角色
- 集群内部各个服务器的调度者
- 事务请求（写操作）的唯一调度和处理者，保证集群事务处理的顺序性；
  对于 create、setData、delete 等有写操作的请求，则需要统一转发给 Leader 处理，
  Leader 需要决定编号、执行操作，这个过程称为一个事务

### Follower

- 处理客户端非事务（读操作）请求
- 转发事务请求给 Leader
- 参与集群 Leader 选举投票， `2n - 1` 台可以做集群投票

### Observer

此外，针对访问量较大的 ZooKeeper 集群，还可新增观察者角色。

- 观察者角色，观察 ZooKeeper 集群的最新状态变化，并将这些状态同步过来，其对于非事务请求可以进行独立处理；
  对于事务请求，则会转发给 Leader 服务器进行处理
- 不会参与任何形式的投票，只提供非事务服务，通常用于在不影响集群事务处理能力的前提下，提升集群的非事务处理能力，增加了集群
  **读请求的并发**

## ZooKeeper 特点

- 集群视角：
    - 角色：一个领导者（Leader），多个跟随者（Follower）组成的集群
        - Leader 负责进行投票的发起和决议，更新系统状态。Leader 不是人为指定来的，而选择出来的。
        - Follower 用于接收客户请求，并向客户端返回结果；在选举 Leader 过程中参与投票
    - 集群HA：集群中只要有**半数以上节点存活**，ZooKeeper 集群就能正常服务。
- 数据视角：
    - 全局数据一致：每个 Server 保存一份相同的数据副本，Client 无论连接到哪个 Server，数据都是一致的。
    - 更新请求，顺序进行
    - 数据更新原子性：一次数据更新，要么成功，要么失败



