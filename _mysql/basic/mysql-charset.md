---
title: "MySQL 字符编码"
sequence: "110"
---

这里把字符编码单独拿出来讲解，也是因为曾经踩过坑，所以拿出来说明避免更多的人入坑。
我们常用的字符集是 latin1、gbk/gb2312、utf8/utf8mb4。

为了避免乱码问题，我们一般会选用 utf8/utf8mb4，而这两者一般情况下都是没有差异的，都能正常使用。
但小编遇到一个问题，使用 utf8mb4 可以但 utf8 不行，就是存储含有表情包（如火星文 ,moji 表情等）的昵称时，
使用 utf8 会抛出异常，表情包被识别为 \xF0\x9F\x8D\x89Ch。

后面分析得知，moji 表情是字符 ，不是图片 ，属于 unicode，发生上面的异常也是数据库根本不认识 '\xF0\x9F\x8D\x89Ch...',
在字符集中没有匹配到 ，导致 '\xF0\x9F\x8D\x89Ch...' 直接入库 ，发生异常。

所以我们要配置一个合适的字符集，使数据库支持这个字符，我们从字符的长度来进行分析，UTF8 使用可变长度字节来存储 Unicode 字符，
目前可见字符集都只需要 3 个字节，包含了所有字符。但是问题出在 unicode6 系列编码上，它们需要 4 个字节，这部分就是有名的 emoji。
如果我们的数据库使用 utf8，是无法存储 emoji 表情的。正好 utf8mb4 一个字符最多能存 4 字节，相对于 utf-8 来说能支持更多的字符集，
也能满足存储 moji 表情的需求。

特别注意的是从 MySQL 5.5.3 版本才开始提供了 utf8mb4 字符集，支持四字节的字符。另外 JDBC 驱动版本要求 mysql-connector 版本高于 5.1.13。

在 5.5.3 之前，MySQL 的 utf8 编码最大支持 3 字节，即 utf8mb3 编码（mb3：MultiByte 3）。在 5.5.3 之后，新增加了 utf8mb4 编码，用来兼容 4 字节的 Unicode（囊括了所有 Unicode 字符，包括未来添加进来的 Unicode 字符，如 Emoji，不常用汉字等）。utf8mb4 是 utf8mb3 的超集。

