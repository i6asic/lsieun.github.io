---
title: "MySQL 索引"
sequence: "108"
---

## 什么是索引

在关系数据库中，索引是一种单独的、物理的对数据库表中一列或多列的值进行排序的一种存储结构，
它是某个表中一列或若干列值的集合和相应的指向表中物理标识这些值的数据页的逻辑指针清单。
索引的作用相当于图书的目录，可以根据目录中的页码快速找到所需的内容。

如果数据库中没有索引，此时查找的时候就需要把整个表遍历一遍。
比如如果想找 id 为 1 的图书信息，没有索引的查找过程就相当于一个"顺序表查找"，
数据量少的时候查询效率差异倒不是很明显，一旦数据量比较大，达到千万亿级别的时候，查询就会特别的慢。

而如果加了索引，查询效率可以提升几倍设置成百上千倍，当然这也不是完全绝对的，还取决与开发人员编写的 SQL 语句性能。

## MySQL 有哪些索引类型

### 普通索引【INDEX】

普通索引是最基本的索引，它没有任何限制，一张表可以创建多个普通索引，一个普通索引可以包含多个字段，允许数据重复，允许 NULL 值插入。普通索引仅加速查询。

### 唯一索引【UNIQUE INDEX】和主键索引【PRIMARY KEY】

唯一索引与普通索引类似，不同的就是：索引列的值必须唯一，这里要注意的是，索引值是否允许为空，
要分情况说明，多数可允许有空值，但主键索引是一类特殊的唯一索引，不可为空。如果是组合索引，则列值的组合必须唯一。
简单来说：唯一索引是加速查询 + 列值唯一。

### 组合索引

组合索引(也叫复合索引或者联合索引)，即一个索引包含多个列。
组合索引指在多个字段上创建的索引，只有在查询条件中使用了创建索引时的第一个字段，索引才会被使用。
使用组合索引时遵循最左前缀集合。可以说：组合索引是多列值组成的一个索引，专门用于组合搜索，其效率大于索引合并。

严格来说，组合索引不算是单独的一类，因为组合索引也可以是普通索引或者唯一索引，只要索引建立在多列上，普通索引和唯一索引都是可以在多列上建立组合索引的。

### 全文索引【FULLTEXT】

全文索引主要用来查找文本中的关键字，而不是直接与索引中的值相比较。
fulltext 索引跟其它索引大不相同，它更像是一个搜索引擎，而不是简单的 where 语句的参数匹配。
fulltext 索引配合 match against 操作使用，而不是一般的 where 语句加 like。
它可以在 create table，alter table ，create index 使用，不过目前只有 char、varchar、text 列上可以创建全文索引。
值得一提的是，在数据量较大时候，先将数据放入一个没有全局索引的表中，然后再用 CREATE index 创建 fulltext 索引，
要比先为一张表建立 fulltext 然后再将数据写入的速度快很多。

## MySQL 如何分析索引是否生效

最简单的方式就是通过客户端连接管理工具，使用它的解释功能，查看 possible_keys 字段值。

或者直接在查询语句前面添加关键词 explain，对于 explain 查询出来的结果，还是看 possible_keys 用到的索引是不是查询字段的索引。

## MySQL 索引为什么加快数据的检索速度

很多人知道使用索引可以提高查询效率，但是可能不太了解为什么可以加快数据的检索速度。
MySQL 索引默认使用的数据结构是 B+ 树，B+ 树可以理解是扁且宽的（矮胖）。
也就是层数少，每层的节点数目很多。但是每层的节点多归多，却不存储数据，只起到索引效果，所有的数据都存在叶子节点上头。
MySQL 的数据是直接存储在磁盘上的，而对于从磁盘查找数据来说，需要经历寻道、寻址、数据传输三个阶段，
使用 B+ 树，层数少，只在叶子节点存数据的特点就能极大的保证磁盘 IO 次数少，从而效率高。

有一些人可能会有疑问，为什么设计的是 B+ 树，而不是 B 树或者哈希表？
我们举一个例子说明，在需要根据范围查询时，比如我需要查询某一段时间内的数据，使用 B 树和哈希表在实现范围查询时效率都比较低。
B+ 树的叶子节点使用了指针顺序（链表）从小到大地连接在一起，B+ 树叶节点两两相连可大大增加区间访问性，
只要遍历叶子节点就可以实现整棵树的遍历，而 B 树的叶子节点是相互独立的，每个节点 key（索引）和 data 在一起，则无法查找区间；
再说哈希表，哈希表是一种以 key-value 存储数据的结构，所以多个数据在存储关系上是完全没有任何顺序关系的，
所以，对于区间查询是无法直接通过索引查询的，就需要全表扫描。

虽然索引有它的优势，但不是创建的越多越好，比如我们就不适合把每一列字段都建立索引，创建索引和维护索引要耗费时间，这种时间随着数据量的增加而增加。
另外索引需要占用物理空间，除了数据表占数据空间之外，每一个索引还要占一定的物理空间



