---
title: "gossip 协议"
sequence: "103"
---

## 节点间的内部通信机制

### 基础通信原理

redis cluster 节点间采取 gossip 协议进行通信

跟集中式不同，不是将集群元数据（节点信息，故障，等等）集中存储在某个节点上，而是互相之间不断通信，保持整个集群所有节点的数据是完整的

维护集群的元数据用得，集中式，一种叫做 gossip

集中式：好处在于，元数据的更新和读取，时效性非常好，一旦元数据出现了变更，立即就更新到集中式的存储中，其他节点读取的时候立即就可以感知到； 
不好在于，所有的元数据的跟新压力全部集中在一个地方，可能会导致元数据的存储有压力

gossip：好处在于，元数据的更新比较分散，不是集中在一个地方，更新请求会陆陆续续，打到所有节点上去更新，有一定的延时，降低了压力；
缺点，元数据更新有延时，可能导致集群的一些操作会有一些滞后

我们刚才做 reshard，去做另外一个操作，会发现说，configuration error，达成一致

### 10000 端口

每个节点都有一个专门用于节点间通信的端口，就是自己提供服务的端口号 +10000，比如 7001，那么用于节点间通信的就是 17001 端口

每隔节点每隔一段时间都会往另外几个节点发送 ping 消息，同时其他几点接收到 ping 之后返回 pong

### 交换的信息

故障信息，节点的增加和移除，hash slot 信息，等等
