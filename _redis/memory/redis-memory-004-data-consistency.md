---
title: "Redis 缓存和数据库一致性"
sequence: "104"
---

缓存最常用的策略：服务端需要同时维护 DB 和 Cache，并且以 DB 的结果为准 —— Cache Aside。

## 读取数据

## 写数据流程

先**缓存**，后**数据库**：

- 先**更新**缓存，再**更新**数据库
- 先**删除**缓存，再**更新**数据库

先**数据库**，后**缓存**：

- 先**更新**数据库，再**更新**缓存
- 先**更新**数据库，再**删除**缓存


第 1 个问题，对于**缓存**来说，是用**更新**，还是用**删除**呢？

- 缓存的更新成本更高。许多情况下，写入数据库的值，并不能直接用于写入缓存，而是要经过一系列复杂的计算后，再写入缓存。
- 删除缓存操作简单，更合适。副作用，只是增加了一次 Cache Miss。**建议使用删除策略**。

第 2 个问题，是先操作**数据库**，还是先操作**缓存**？

## 最终一致性

### 延迟双删


## Reference

- [redis如何保证缓存和数据库的一致性](https://www.bilibili.com/video/BV1Ua4y1r7hi/)
