---
title: "Canary Release （灰度发布/金丝雀发布）"
sequence: "canary-release"
---

金丝雀发布（Canary Release）是一种软件发布策略，用于逐步引入新功能或更新到生产环境中，以减少潜在的风险并收集实时反馈。
在金丝雀发布中，新版本的软件被部署在一小部分目标用户（或服务器实例）上，而不是一次性将其部署到所有用户中。

## 名称由来

金丝雀发布策略的名称源于金丝雀这种小鸟的行为。在煤矿开采的早期，矿工们使用金丝雀作为安全指示器。
由于金丝雀对有害气体，尤其是一氧化碳，非常敏感，它们在遇到高浓度有毒气体时会更早地显示异常行为，例如死亡或失去知觉。
这种早期警示帮助矿工们意识到存在危险并采取安全措施。

类似地，金丝雀发布策略在软件开发中起到类似的作用。
通过选择一小部分用户或服务器作为"金丝雀"，新版本的软件在这个小范围内进行部署和测试。
如果出现问题，相对于全部用户都受到影响，只有金丝雀用户或服务器受到影响，就像是先引起了小范围的警示。
这使得团队可以更早地识别问题并采取相应措施，从而减少潜在的影响范围和风险。

因此，金丝雀发布这个术语的命名灵感来自于这种将小鸟用作危险指示器的实践，将其应用到软件发布过程中的类比。

## 发布步骤

以下是一般金丝雀发布的步骤：

1. 选择目标用户或服务器：确定金丝雀发布的目标用户或服务器，并将新版本的软件部署在其中的一小部分上。

2. 配置路由/负载均衡：使用路由或负载均衡器，将一部分用户的流量重定向到金丝雀版本。例如，可以使用 DNS 调度、反向代理或 API 网关等。

3. 监控和收集反馈：通过监控金丝雀用户或服务器的指标和日志，收集有关新版本的性能、稳定性和用户反馈的数据。

4. 评估和验证：根据监控数据和用户反馈，评估新版本的表现，确保它符合预期并不会造成严重的问题。

5. 逐步扩大规模：如果金丝雀版本表现良好，可以逐步将其在更多用户或服务器上进行扩大规模的部署。这可以在测试通过和性能验证后进行。

6. 回滚或继续发布：如果金丝雀版本存在问题或表现不理想，可以根据需要回滚到旧版本，或者进行修复后继续发布。

通过金丝雀发布，开发团队可以尽早将新版本的软件推向生产环境，并在小范围内进行验证和修复，从而降低了潜在的影响范围和风险。
这种策略帮助团队更快地获取反馈和识别问题，进而改善软件质量和用户体验。



